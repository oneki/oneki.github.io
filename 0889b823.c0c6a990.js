(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{140:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return g}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=o.a.createContext({}),l=function(e){var t=o.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},b=function(e){var t=l(e.components);return o.a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},p=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),b=l(n),p=a,g=b["".concat(i,".").concat(p)]||b[p]||d[p]||r;return n?o.a.createElement(g,s(s({ref:t},u),{},{components:n})):o.a.createElement(g,s({ref:t},u))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=p;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<r;u++)i[u]=n[u];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},141:function(e,t,n){"use strict";function a(e){var t,n,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(o&&(o+=" "),o+=n);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}t.a=function(){for(var e,t,n=0,o="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(o&&(o+=" "),o+=t);return o}},142:function(e,t,n){"use strict";var a=n(0),o=n(143);t.a=function(){var e=Object(a.useContext)(o.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},143:function(e,t,n){"use strict";var a=n(0),o=Object(a.createContext)(void 0);t.a=o},144:function(e,t,n){"use strict";var a=n(0),o=n.n(a);t.a=function(e){return o.a.createElement("div",null,e.children)}},145:function(e,t,n){"use strict";var a=n(0),o=n.n(a),r=n(142),i=n(141),s=n(48),c=n.n(s),u=37,l=39;t.a=function(e){var t=e.block,n=e.children,s=e.defaultValue,b=e.values,d=e.groupId,p=e.className,g=Object(r.a)(),h=g.tabGroupChoices,m=g.setTabGroupChoices,v=Object(a.useState)(s),f=v[0],O=v[1],j=Object(a.useState)(!1),N=j[0],w=j[1];if(null!=d){var y=h[d];null!=y&&y!==f&&b.some((function(e){return e.value===y}))&&O(y)}var x=function(e){O(e),null!=d&&m(d,e)},k=[],R=function(e){e.metaKey||e.altKey||e.ctrlKey||w(!0)},L=function(){w(!1)};return Object(a.useEffect)((function(){return window.addEventListener("keydown",R),window.addEventListener("mousedown",L),function(){window.removeEventListener("keydown",R),window.removeEventListener("mousedown",L)}}),[]),o.a.createElement("div",null,o.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(i.a)("tabs",{"tabs--block":t},p)},b.map((function(e){var t=e.value,n=e.label;return o.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":f===t,className:Object(i.a)("tabs__item",c.a.tabItem,{"tabs__item--active":f===t}),style:N?{}:{outline:"none"},key:t,ref:function(e){return k.push(e)},onKeyDown:function(e){!function(e,t,n){switch(n.keyCode){case l:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case u:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(k,e.target,e),R(e)},onFocus:function(){return x(t)},onClick:function(){x(t),w(!1)},onPointerDown:function(){return w(!1)}},n)}))),o.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},a.Children.toArray(n).filter((function(e){return e.props.value===f}))[0]))}},146:function(e,t,n){"use strict";var a=n(0),o=n(20);t.a=function(){var e=Object(a.useContext)(o.a);if(null===e)throw new Error("Docusaurus context not provided");return e}},147:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));var a=n(146),o=n(148);function r(){var e=Object(a.a)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,n=void 0===t?"/":t,r=e.url;return{withBaseUrl:function(e,t){return function(e,t,n,a){var r=void 0===a?{}:a,i=r.forcePrependBaseUrl,s=void 0!==i&&i,c=r.absolute,u=void 0!==c&&c;if(!n)return n;if(n.startsWith("#"))return n;if(Object(o.b)(n))return n;if(s)return t+n;var l=n.startsWith(t)?n:t+n.replace(/^\//,"");return u?e+l:l}(r,n,e,t)}}}function i(e,t){return void 0===t&&(t={}),(0,r().withBaseUrl)(e,t)}},148:function(e,t,n){"use strict";function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function o(e){return void 0!==e&&!a(e)}n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o}))},149:function(e,t,n){"use strict";var a=n(0),o=n.n(a);t.a=function(e){var t=e.name,n=e.height,a=void 0===n?500:n,r=e.modules,i=e.branch,s=void 0===i?"master":i,c=e.type,u=void 0===c?"example":c,l=e.view,b="https://codesandbox.io/embed/github/oneki/onekijs/tree/"+s+"/"+u+"/"+t+"?codemirror=1&fontsize=14&theme=dark&view="+(void 0===l?"editor":l);r&&(b+="&module=",r.forEach((function(e,t){t>0&&(b+=","),b+=e})));var d="onekijs-"+t.split("/").join("-");return o.a.createElement("iframe",{src:b,style:{width:"100%",height:a+"px",border:0,bordeRadius:"4px",overflow:"hidden"},title:d,allow:"geolocation; microphone; camera; midi; accelerometer; gyroscope; payment; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"})}},55:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return u})),n.d(t,"default",(function(){return b}));var a=n(1),o=n(6),r=(n(0),n(140)),i=(n(147),n(145),n(144),n(149)),s={id:"authentication",title:"Adding authentication",sidebar_label:"Adding authentication"},c={unversionedId:"overview/getting-started/authentication",id:"overview/getting-started/authentication",isDocsHomePage:!1,title:"Adding authentication",description:"This step consists of adding an authentication system to the application",source:"@site/docs/overview/getting-started/005_authentication.md",slug:"/overview/getting-started/authentication",permalink:"/docs/overview/getting-started/authentication",editUrl:"https://github.com/oneki/oneki.github.io/edit/source/docs/overview/getting-started/005_authentication.md",version:"current",sidebar_label:"Adding authentication",sidebar:"someSidebar",previous:{title:"Adding state management",permalink:"/docs/overview/getting-started/global-state"},next:{title:"Managing data",permalink:"/docs/overview/getting-started/data"}},u=[{value:"Final result",id:"final-result",children:[]},{value:"Securing the cart page",id:"securing-the-cart-page",children:[]},{value:"Adding a global configuration",id:"adding-a-global-configuration",children:[]},{value:"Adding the login page",id:"adding-the-login-page",children:[{value:"Updating Navbar to display the logged user",id:"updating-navbar-to-display-the-logged-user",children:[]}]},{value:"Adding the logout page",id:"adding-the-logout-page",children:[{value:"Updating Navbar to display a logout link",id:"updating-navbar-to-display-a-logout-link",children:[]}]},{value:"Next step",id:"next-step",children:[]}],l={rightToc:u};function b(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"This step consists of adding an authentication system to the application"),Object(r.b)("p",null,"Oneki.js provides an authentication library offering:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"several authentication method (form based, oauth2, external login, ...)"),Object(r.b)("li",{parentName:"ul"},"access restriction of pages to authenticated users only (can be based on roles)."),Object(r.b)("li",{parentName:"ul"},"providing a security context accessible anywhere in the application. The security context contains data identifying the logged user (username, roles, ...)")),Object(r.b)("h2",{id:"final-result"},"Final result"),Object(r.b)("p",null,"The result of this step is the following:"),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"New in this step")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"The cart page (acessible via the checkout button) is now restricted to authenticated user only",Object(r.b)("br",null),"\nIf you are not authenticated yet, you are redirected to the login page when you can sign in."))),Object(r.b)(i.a,{name:"step04-authentication",type:"getting-started",view:"preview",height:"600",modules:["/src/index.tsx","/src/pages/products/index.tsx"],mdxType:"Sandbox"}),Object(r.b)("h2",{id:"securing-the-cart-page"},"Securing the cart page"),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Oneki.js provides several hooks to handle authentication",Object(r.b)("br",null),"\nIn this tutorial, we are going to use these hooks:"),Object(r.b)("ul",{parentName:"div"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"useLogin")," returns a service handling the login phase. In our case sending a POST request to /auth/login containing username / password"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"useLogout")," returns a service handling the logout phase. In our case, sending a GET request to /auth/logout"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"useSecurityContext")," returns an object identifying the logged user")))),Object(r.b)("p",null,"To prevent non authenticated user to access the cart page, use the HOC ",Object(r.b)("strong",{parentName:"p"},"secure")," (to learn more about HOC, ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://reactjs.org/docs/higher-order-components.html"}),"click here"),")"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'{6} title="src/pages/cart.tsx"',"{6}":!0,title:'"src/pages/cart.tsx"'}),"const CartPage: FC = () => {\n  const cart: ProductType[] = useGlobalSelector('cart', []); // TODO change to useGlobalProp\n  return <Cart cart={cart} />;\n};\n\nexport default secure(CartPage);\n")),Object(r.b)("p",null,"By default, a non authenticated user is redirect to /login. ",Object(r.b)("br",null),"However, in our case, we want to redirect the user to /auth. This can be configured via a global configuration introduced hereafter"),Object(r.b)("h2",{id:"adding-a-global-configuration"},"Adding a global configuration"),Object(r.b)("p",null,"Oneki.js recommends to put the configuration parameters in a central place. Generally, the configuration is placed in the file ",Object(r.b)("strong",{parentName:"p"},"src/settings.ts"),"."),Object(r.b)("p",null,"Some components of the framework use the content of this file to configure themself. This is the case of the HOC ",Object(r.b)("strong",{parentName:"p"},"secure"),Object(r.b)("br",null),"\nTo redirect the user to /auth instead of /login, add the file src/settings.ts with the following content:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'title="src/settings.ts"',title:'"src/settings.ts"'}),"export default {\n  routes: {\n    // redirect to /auth if a non authenticated user\n    // tries to access a secured page\n    login: '/auth',\n  },\n} as AppSettings;\n")),Object(r.b)("p",null,"and pass the configuration to ",Object(r.b)("inlineCode",{parentName:"p"},"App")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'{4} title="src/index.ts"',"{4}":!0,title:'"src/index.ts"'}),"import settings from './settings';\n\nReactDOM.render(\n  <App settings={settings}>\n    <RootRouter />\n  </App>,\n  document.getElementById('root'),\n);\n")),Object(r.b)("h2",{id:"adding-the-login-page"},"Adding the login page"),Object(r.b)("p",null,"The login page displays a very basic form containing two fields: ",Object(r.b)("strong",{parentName:"p"},"username")," and ",Object(r.b)("strong",{parentName:"p"},"password"),Object(r.b)("br",null),"\nThe page uses the hook ",Object(r.b)("strong",{parentName:"p"},"useLogin")," to handle the login phase which consists of:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"sending a POST ajax request containing the username / password to a server"),Object(r.b)("li",{parentName:"ul"},"handling the response by creating a security context and storing it in the global state. The content of the security context is the content of the response.")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"useLogin")," also uses the global configuration to know:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"the type of authentication (form based, external, Oauth2, ...)"),Object(r.b)("li",{parentName:"ul"},"the URL to use to send the POST request")),Object(r.b)("p",null,"Let's first update the content of src/settings.ts"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'{5-17} title="src/settings.ts"',"{5-17}":!0,title:'"src/settings.ts"'}),"export default {\n  routes: {\n    login: '/auth',\n  },\n  idp: {\n    default: {\n      // We want to use a form based authentication\n      type: 'form',\n      // The URL to send the POST request containing\n      // username / password \n      loginEndpoint: '/auth/login',\n      // URL to retrieve the security context\n      // This URL is called to verify if the user\n      // is already authenticated or not\n      userinfoEndpoint: '/userinfo', \n    },\n  },\n} as AppSettings;\n")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"The endpoints /auth/login, /auth/logout and /userinfo are mocked to simulate a backend server.",Object(r.b)("br",null),"\nThe mocked server is defined in src/","_","_server__"),Object(r.b)("p",{parentName:"div"},"You can check the documentation of the library ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("a",Object(a.a)({parentName:"strong"},{href:"https://mswjs.io/"}),"msw"))," to learn more about mocking a server inside a browser"))),Object(r.b)("p",null,"Then create the auth page:"),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"The auth page is using the hook ",Object(r.b)("strong",{parentName:"p"},"useForm")," which is explained later in the step ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("a",Object(a.a)({parentName:"strong"},{href:"./form"}),"Adding form"))))),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'title="src/pages/login.tsx"',title:'"src/pages/login.tsx"'}),'const LoginPage: FC = () => {\n  const [error, submitting , submit] = useLogin();\n\n  const { Form } = useForm(submit);\n\n  return (\n    <Form className="w-full">\n      {error && <div className="error">Error: {error.message}</div>}\n      <div>\n        <label>Username</label>\n        <Input name="username" type="text" />\n      </div>\n      <div>\n        <label>Password</label>\n        <Input name="password" type="password" />\n      </div>\n      <SubmitButton type="submit">\n        {!submitting && \'Submit\'}\n        {submitting && \'Submitting...\'}\n      </SubmitButton>\n    </Form>\n  );\n};\n\nexport default LoginPage;\n')),Object(r.b)("p",null,"Create a route to associate the LoginPage to /auth"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'{4-6} title="src/pages/_router.tsx"',"{4-6}":!0,title:'"src/pages/_router.tsx"'}),'const RootRouter = (): JSX.Element => {\n  return (\n    <Switch>\n      <Route path="/login">\n        <LoginPage />\n      </Route>\n      <Route>\n        <AppLayout>\n          <Switch>\n            <Route path="/products">\n              <ProductsRouter />\n            </Route>\n            <Route path="/cart">\n              <CartPage />\n            </Route>\n            <Route>\n              <Redirect to="/products" />\n            </Route>\n          </Switch>\n        </AppLayout>\n      </Route>\n    </Switch>\n  );\n};\n\nexport default RootRouter;\n')),Object(r.b)("h3",{id:"updating-navbar-to-display-the-logged-user"},"Updating Navbar to display the logged user"),Object(r.b)("p",null,"Now we want to display the username of the logged user in the top bar.",Object(r.b)("br",null),"\nWe can retrieve the username anywhere in the application via the hook ",Object(r.b)("strong",{parentName:"p"},"useSecurityContext")),Object(r.b)("p",null,"The content of the security context is the response sent by the backend when calling the userinfo endpoint.",Object(r.b)("br",null),"In our case, the backend returns a very simple object containing only the username:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "username": "john.doe"\n}\n')),Object(r.b)("p",null,"To display the username in the Navbar, update src/modules/core/components/Navbar.tsx:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'{5,11-13} title="src/modules/core/components/Navbar.tsx"',"{5,11-13}":!0,title:'"src/modules/core/components/Navbar.tsx"'}),'const Navbar: FC = () => {\n  // retrieve the field username from the security context\n  // if the user is not logged, loggedUser is undefined\n  const [loggedUser] = useSecurityContext(\'username\');\n  return (\n    <div className="app-top-bar">\n      <Link to="/">\n        <h1>My Store</h1>\n      </Link>\n      <div className="app-top-bar-right">\n        {loggedUser && (\n          <div className="user">{loggedUser}</div>\n        )}\n        <Link to="/cart" className="button fancy-button">\n          <i className="material-icons">shopping_cart</i>\n          Checkout\n        </Link>\n      </div>\n    </div>\n  );\n};\n\nexport default Navbar;\n')),Object(r.b)("h2",{id:"adding-the-logout-page"},"Adding the logout page"),Object(r.b)("p",null,"We want to provide the user a link to logout.",Object(r.b)("br",null),"\nThe logout action calls the backend server to remove the cookie and clean the security context from the global state."),Object(r.b)("p",null,"This action is handled by the hook ",Object(r.b)("strong",{parentName:"p"},"useLogout"),". This hook retrieves the logout endpoint from settings.ts:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'{9} title="src/settings.ts"',"{9}":!0,title:'"src/settings.ts"'}),"export default {\n  routes: {\n    login: '/auth',\n  },\n  idp: {\n    default: {\n      type: 'form', \n      loginEndpoint: '/auth/login',\n      logoutEndpoint: '/auth/logout',\n      userinfoEndpoint: '/userinfo', \n    },\n  },\n} as AppSettings;\n")),Object(r.b)("p",null,"Create a logout page to handle the logout process.",Object(r.b)("br",null),"\nBy default, the hook ",Object(r.b)("strong",{parentName:"p"},"useLogout")," sends a GET request to the backend server"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'title="src/pages/logout.tsx"',title:'"src/pages/logout.tsx"'}),"const LogoutPage: FC = () => {\n  const [error, loading] = useLogout();\n\n  if (error) return <div>Error: {JSON.stringify(error)}</div>;\n  if (loading) return <div>Logging out ...</div>;\n  return null;\n};\n\nexport default LogoutPage;\n")),Object(r.b)("p",null,"Update the router to take into account this new page"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'{7-9} title="src/pages/_router.tsx"',"{7-9}":!0,title:'"src/pages/_router.tsx"'}),'const RootRouter = (): JSX.Element => {\n  return (\n    <Switch>\n      <Route path="/login">\n        <LoginPage />\n      </Route>\n      <Route path="/logout">\n        <LogoutPage />\n      </Route>\n      <Route>\n        <AppLayout>\n          <Switch>\n            <Route path="/products">\n              <ProductsRouter />\n            </Route>\n            <Route path="/cart">\n              <CartPage />\n            </Route>\n            <Route>\n              <Redirect to="/products" />\n            </Route>\n          </Switch>\n        </AppLayout>\n      </Route>\n    </Switch>\n  );\n};\n\nexport default RootRouter;\n')),Object(r.b)("h3",{id:"updating-navbar-to-display-a-logout-link"},"Updating Navbar to display a logout link"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-tsx",metastring:'{12-14} title="src/modules/core/components/Navbar.tsx"',"{12-14}":!0,title:'"src/modules/core/components/Navbar.tsx"'}),'const Navbar: FC = () => {\n  const [loggedUser] = useSecurityContext(\'username\');\n  return (\n    <div className="app-top-bar">\n      <Link to="/">\n        <h1>My Store</h1>\n      </Link>\n      <div className="app-top-bar-right">\n        {loggedUser && (\n          <div className="user">\n            {loggedUser}{\' \'}\n            <Link className="logout" to="/logout">\n              [Log out]\n            </Link>\n          </div>\n        )}\n        <Link to="/cart" className="button fancy-button">\n          <i className="material-icons">shopping_cart</i>\n          Checkout\n        </Link>\n      </div>\n    </div>\n  );\n};\n\nexport default Navbar;\n')),Object(r.b)("h2",{id:"next-step"},"Next step"),Object(r.b)("p",null,"Now that we can identify the logged user, we can save the content of the cart in the cloud so we don't loose its content after a refresh",Object(r.b)("br",null),"\n",Object(r.b)("strong",{parentName:"p"},Object(r.b)("a",Object(a.a)({parentName:"strong"},{href:"data"}),"In the next step")),", we introduce the services offered by Oneki.js to retrieve and send data via AJAX requests. "))}b.isMDXComponent=!0}}]);