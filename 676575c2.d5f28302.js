(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{140:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return v}));var n=a(0),i=a.n(n);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=i.a.createContext({}),d=function(e){var t=i.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},b=function(e){var t=d(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},p=i.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),b=d(a),p=n,v=b["".concat(o,".").concat(p)]||b[p]||u[p]||r;return a?i.a.createElement(v,l(l({ref:t},s),{},{components:a})):i.a.createElement(v,l({ref:t},s))}));function v(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,o=new Array(r);o[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var s=2;s<r;s++)o[s]=a[s];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,a)}p.displayName="MDXCreateElement"},141:function(e,t,a){"use strict";function n(e){var t,a,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(i&&(i+=" "),i+=a);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}t.a=function(){for(var e,t,a=0,i="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(i&&(i+=" "),i+=t);return i}},142:function(e,t,a){"use strict";var n=a(0),i=a(143);t.a=function(){var e=Object(n.useContext)(i.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},143:function(e,t,a){"use strict";var n=a(0),i=Object(n.createContext)(void 0);t.a=i},144:function(e,t,a){"use strict";var n=a(0),i=a.n(n);t.a=function(e){return i.a.createElement("div",null,e.children)}},145:function(e,t,a){"use strict";var n=a(0),i=a.n(n),r=a(142),o=a(141),l=a(48),c=a.n(l),s=37,d=39;t.a=function(e){var t=e.block,a=e.children,l=e.defaultValue,b=e.values,u=e.groupId,p=e.className,v=Object(r.a)(),m=v.tabGroupChoices,h=v.setTabGroupChoices,g=Object(n.useState)(l),O=g[0],f=g[1],j=Object(n.useState)(!1),y=j[0],w=j[1];if(null!=u){var N=m[u];null!=N&&N!==O&&b.some((function(e){return e.value===N}))&&f(N)}var x=function(e){f(e),null!=u&&h(u,e)},A=[],S=function(e){e.metaKey||e.altKey||e.ctrlKey||w(!0)},T=function(){w(!1)};return Object(n.useEffect)((function(){return window.addEventListener("keydown",S),window.addEventListener("mousedown",T),function(){window.removeEventListener("keydown",S),window.removeEventListener("mousedown",T)}}),[]),i.a.createElement("div",null,i.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(o.a)("tabs",{"tabs--block":t},p)},b.map((function(e){var t=e.value,a=e.label;return i.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":O===t,className:Object(o.a)("tabs__item",c.a.tabItem,{"tabs__item--active":O===t}),style:y?{}:{outline:"none"},key:t,ref:function(e){return A.push(e)},onKeyDown:function(e){!function(e,t,a){switch(a.keyCode){case d:!function(e,t){var a=e.indexOf(t)+1;e[a]?e[a].focus():e[0].focus()}(e,t);break;case s:!function(e,t){var a=e.indexOf(t)-1;e[a]?e[a].focus():e[e.length-1].focus()}(e,t)}}(A,e.target,e),S(e)},onFocus:function(){return x(t)},onClick:function(){x(t),w(!1)},onPointerDown:function(){return w(!1)}},a)}))),i.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},n.Children.toArray(a).filter((function(e){return e.props.value===O}))[0]))}},146:function(e,t,a){"use strict";var n=a(0),i=a(20);t.a=function(){var e=Object(n.useContext)(i.a);if(null===e)throw new Error("Docusaurus context not provided");return e}},147:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return o}));var n=a(146),i=a(148);function r(){var e=Object(n.a)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,a=void 0===t?"/":t,r=e.url;return{withBaseUrl:function(e,t){return function(e,t,a,n){var r=void 0===n?{}:n,o=r.forcePrependBaseUrl,l=void 0!==o&&o,c=r.absolute,s=void 0!==c&&c;if(!a)return a;if(a.startsWith("#"))return a;if(Object(i.b)(a))return a;if(l)return t+a;var d=a.startsWith(t)?a:t+a.replace(/^\//,"");return s?e+d:d}(r,a,e,t)}}}function o(e,t){return void 0===t&&(t={}),(0,r().withBaseUrl)(e,t)}},148:function(e,t,a){"use strict";function n(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!n(e)}a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return i}))},149:function(e,t,a){"use strict";var n=a(0),i=a.n(n);t.a=function(e){var t=e.name,a=e.height,n=void 0===a?500:a,r=e.modules,o=e.branch,l=void 0===o?"master":o,c=e.type,s=void 0===c?"example":c,d=e.view,b="https://codesandbox.io/embed/github/oneki/onekijs/tree/"+l+"/"+s+"/"+t+"?codemirror=1&fontsize=14&theme=dark&view="+(void 0===d?"editor":d);r&&(b+="&module=",r.forEach((function(e,t){t>0&&(b+=","),b+=e})));var u="onekijs-"+t.split("/").join("-");return i.a.createElement("iframe",{src:b,style:{width:"100%",height:n+"px",border:0,bordeRadius:"4px",overflow:"hidden"},title:u,allow:"geolocation; microphone; camera; midi; accelerometer; gyroscope; payment; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"})}},87:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return l})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return b}));var n=a(1),i=a(6),r=(a(0),a(140)),o=(a(147),a(145),a(144),a(149)),l={id:"service",title:"Adding a service",sidebar_label:"Adding a service"},c={unversionedId:"overview/getting-started/service",id:"overview/getting-started/service",isDocsHomePage:!1,title:"Adding a service",description:"This step consists in creating its own service.",source:"@site/docs/overview/getting-started/011_service.md",slug:"/overview/getting-started/service",permalink:"/docs/overview/getting-started/service",editUrl:"https://github.com/oneki/oneki.github.io/edit/source/docs/overview/getting-started/011_service.md",version:"current",sidebar_label:"Adding a service",sidebar:"someSidebar",previous:{title:"Using form for user input",permalink:"/docs/overview/getting-started/form"},next:{title:"Application",permalink:"/docs/overview/app"}},s=[{value:"Final result",id:"final-result",children:[]},{value:"Creating a service",id:"creating-a-service",children:[{value:"Adding reducers",id:"adding-reducers",children:[]},{value:"Adding sagas",id:"adding-sagas",children:[]}]},{value:"Using the service",id:"using-the-service",children:[]},{value:"Handling error",id:"handling-error",children:[]},{value:"Next step",id:"next-step",children:[]}],d={rightToc:s};function b(e){var t=e.components,a=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},d,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"This step consists in creating its own service."),Object(r.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"The topic on this page is intended for advanced use cases.",Object(r.b)("br",null),"\nYou will implement a service when you need to add some advanced logic to your application"))),Object(r.b)("p",null,"Almost all things provided by Oneki.js are based on services.",Object(r.b)("br",null),"\nThe role of a service is to mutate a state. This state can be "),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},'a component state. In this case, the service is called a "local services"',Object(r.b)("br",null),"\nExample of hooks exposing a local service: ",Object(r.b)("inlineCode",{parentName:"li"},"useGet"),", ",Object(r.b)("inlineCode",{parentName:"li"},"usePost"),", ..."),Object(r.b)("li",{parentName:"ul"},"the global redux state. In this case, the service is called a global service.",Object(r.b)("br",null),"\nExample of hooks exposing global services: ",Object(r.b)("inlineCode",{parentName:"li"},"useNotificationService"),", ",Object(r.b)("inlineCode",{parentName:"li"},"useSecurityContext"))),Object(r.b)("p",null,"The service mutates the state following the best practices (immutability, action, reducers, ...)",Object(r.b)("br",null),"\nTo mutate the state, it exposes two types of methods:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Reducer methods")," (annoted with @reducer). Only these methods can mutate the state."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"Saga methods")," (annotate with @saga). These methods can orchestrate calls to reducer methods and are used to handle complex scenario like:",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"Calling a reducer to update a loading variable"),Object(r.b)("li",{parentName:"ul"},"Let React rendering the component to display the loading indicator"),Object(r.b)("li",{parentName:"ul"},"Perform a AJAX request asynchronously"),Object(r.b)("li",{parentName:"ul"},"Store the result in the state (by calling another reducer method)"),Object(r.b)("li",{parentName:"ul"},"Calling the first reducer to update the loading variable")))),Object(r.b)("h2",{id:"final-result"},"Final result"),Object(r.b)("p",null,"The result of this step is the following:"),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"New in this step")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},'The product detail page now displays a new button "Check Availability"',Object(r.b)("br",null),"\nWhen you click on this button, the application calls the server to verify if the product is available or not"))),Object(r.b)(o.a,{name:"step10-service",type:"getting-started",view:"preview",height:"600",modules:["/src/index.tsx","/src/pages/products/index.tsx"],mdxType:"Sandbox"}),Object(r.b)("h2",{id:"creating-a-service"},"Creating a service"),Object(r.b)("p",null,"We want to add a button on the product page to check its availability. A click on the button triggers the following scenario:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Add a loading indicator on the button"),Object(r.b)("li",{parentName:"ol"},"Disable the button"),Object(r.b)("li",{parentName:"ol"},"Perform a request to the server to check the availability"),Object(r.b)("li",{parentName:"ol"},"Display the result on the product page next to the button:"),Object(r.b)("li",{parentName:"ol"},"Remove the loading indicator"),Object(r.b)("li",{parentName:"ol"},"Enable the button")),Object(r.b)("p",null,"Therefore, the state contains the following elements:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-ts",metastring:'title="src/modules/products/services/AvailabilityService.ts"',title:'"src/modules/products/services/AvailabilityService.ts"'}),"export interface AvailabilityState {\n  // a flag to indicate if a request is in flight\n  loading: boolean;\n\n  // the result of the request\n  // initial value is undefined\n  available?: boolean; // number of products available\n}\n\n// Reponse returned by the server\ninterface AvailabilityResponse {\n  available: boolean; // number of products available\n}\n")),Object(r.b)("p",null,"Let's create a service to manipulate this state.",Object(r.b)("br",null),"\nA service is a class that extends ",Object(r.b)("inlineCode",{parentName:"p"},"LocalService")," or ",Object(r.b)("inlineCode",{parentName:"p"},"GlobalService"),". In our case, the state is local to a component and therefore the class extends ",Object(r.b)("inlineCode",{parentName:"p"},"LocalService")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"The class must be annotated with @service. This is something specific to Typescript that allows Oneki.js to create a proxy of this class at runtime."),Object(r.b)("p",{parentName:"div"},"If you don't use Typescript, please check this page"))),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-ts",metastring:'title="src/modules/products/services/AvailabilityService.ts"',title:'"src/modules/products/services/AvailabilityService.ts"'}),"@service\nexport default class AvailabilityService extends LocalService<AvailabilityState> {\n  //TODO implementation\n}\n")),Object(r.b)("h3",{id:"adding-reducers"},"Adding reducers"),Object(r.b)("p",null,"As explained above, the service contains two types of method: ",Object(r.b)("inlineCode",{parentName:"p"},"reducer")," and ",Object(r.b)("inlineCode",{parentName:"p"},"saga")),Object(r.b)("p",null,"For our service, we need two reducers:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"A reducer method to mutate the field ",Object(r.b)("inlineCode",{parentName:"li"},"loading")),Object(r.b)("li",{parentName:"ul"},"A reducer method to mutate the field ",Object(r.b)("inlineCode",{parentName:"li"},"available"))),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Reducer methods must be annotated with @reducer"))),Object(r.b)("p",null,"Let's add these two methods:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-ts",metastring:'{3-14} title="src/modules/products/services/AvailabilityService.ts"',"{3-14}":!0,title:'"src/modules/products/services/AvailabilityService.ts"'}),"@service\nexport default class AvailabilityService extends LocalService<AvailabilityState> {\n  @reducer\n  setLoading(loading: boolean): void {\n    // the state is immutable\n    // however, the @reducer annotation allows updating the state\n    // like any other object (thanks to immer)\n    this.state.loading = loading;\n  }\n\n  @reducer\n  setData(data: AvailabilityResponse): void {\n    this.state.available = data.available;\n    this.setLoading(false); // A reducer can call another reducer\n  }\n}\n")),Object(r.b)("h3",{id:"adding-sagas"},"Adding sagas"),Object(r.b)("p",null,"For our service, we need one saga that will implement the following scenario:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Update loading to ",Object(r.b)("inlineCode",{parentName:"li"},"true")),Object(r.b)("li",{parentName:"ol"},"Perform a request to the server to check the availability"),Object(r.b)("li",{parentName:"ol"},"Set the result of the request in the state"),Object(r.b)("li",{parentName:"ol"},"Update loading to ",Object(r.b)("inlineCode",{parentName:"li"},"false"))),Object(r.b)("p",null,"Let's add this method:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-ts",metastring:'{18-23} title="src/modules/products/services/AvailabilityService.ts"',"{18-23}":!0,title:'"src/modules/products/services/AvailabilityService.ts"'}),"@service\nexport default class AvailabilityService extends LocalService<AvailabilityState> {\n  @reducer\n  setLoading(loading: boolean): void {\n    // the state is immutable\n    // however, the @reducer annotation allows updating the state\n    // like any other object (thanks to immer)\n    this.state.loading = loading;\n  }\n\n  @reducer\n  setData(data: AvailabilityResponse): void {\n    this.state.available = data.available;\n    this.setLoading(false); // A reducer can call another reducer\n  }\n\n  // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n  @saga(SagaEffect.Latest)\n  *checkAvailability(productId: number) {\n    yield this.setLoading(true);\n    const data: AvailabilityResponse = yield asyncGet(`/products/${productId}/availability`);\n    yield this.setData(data);\n  }\n}\n")),Object(r.b)("h2",{id:"using-the-service"},"Using the service"),Object(r.b)("p",null,"To instantiate this service, Oneki.js proposes the hooks ",Object(r.b)("inlineCode",{parentName:"p"},"useLocalService")," and ",Object(r.b)("inlineCode",{parentName:"p"},"useGlobalService"),Object(r.b)("br",null),"\nAs we created a local service, we must use ",Object(r.b)("inlineCode",{parentName:"p"},"useLocalService"),":"),Object(r.b)("p",null,"Let's upadte the ",Object(r.b)("inlineCode",{parentName:"p"},"ProductDetails")," component to add a button ",Object(r.b)("inlineCode",{parentName:"p"},"Check Availability")," that uses the service:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-tsx",metastring:'{1-3,7,30-50} title="src/modules/products/components/ProductDetails.ts"',"{1-3,7,30-50}":!0,title:'"src/modules/products/components/ProductDetails.ts"'}),'const initialAvailabilityState: AvailabilityState = {\n  loading: false,\n};\n\nconst ProductDetails: FC<ProductDetailsProps> = ({ product, onBuy }) => {\n  const [T] = useTranslation();\n  const [availability, availabilityService] = useLocalService(AvailabilityService, initialAvailabilityState);\n  return (\n    <div>\n      <h2>\n        <T>Product Details</T>\n      </h2>\n\n      <div>\n        <h3>\n          <T>{product.name}</T>\n        </h3>\n        <h4>\n          <T>{currency(product.price)}</T>\n        </h4>\n        <p>\n          <T>{product.description}</T>\n        </p>\n        <p>\n          <button onClick={onBuy}>\n            <T>Buy</T>\n          </button>\n        </p>\n        <p>\n          <button onClick={() => availabilityService.checkAvailability(product.id)} disabled={availability.loading}>\n            <T>Check availability</T>\n          </button>\n          <span className="availability">\n            {availability.loading && (\n              <span>\n                <T>Loading</T> ...\n              </span>\n            )}\n            {!availability.loading && availability.available === true && (\n              <span className="available">\n                <T>The product is available</T>\n              </span>\n            )}\n            {!availability.loading && availability.available === false && (\n              <span className="not-available">\n                <T>The product is not available</T>\n              </span>\n            )}\n          </span>\n        </p>\n      </div>\n    </div>\n  );\n};\n\nexport default ProductDetails;\n')),Object(r.b)("h2",{id:"handling-error"},"Handling error"),Object(r.b)("p",null,"We can improve the service to handle correctly the errors returned by the server.",Object(r.b)("br",null),"\nOne common approch is to send a notification on the topic ",Object(r.b)("inlineCode",{parentName:"p"},"error")," so the ",Object(r.b)("inlineCode",{parentName:"p"},"<NotificationCenter />")," automatically displays it"),Object(r.b)("p",null,"To be able to use the NotificationService inside the AvailabilityService, one must inject it."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-ts",metastring:'{3,22,26-28} title="src/modules/products/services/AvailabilityService.ts"',"{3,22,26-28}":!0,title:'"src/modules/products/services/AvailabilityService.ts"'}),"@service\nexport default class AvailabilityService extends LocalService<AvailabilityState> {\n  notificationService = inject(NotificationService);\n\n  @reducer\n  setLoading(loading: boolean): void {\n    // the state is immutable\n    // however, the @reducer annotation allows updating the state\n    // like any other object (thanks to immer)\n    this.state.loading = loading;\n  }\n\n  @reducer\n  setData(data: AvailabilityResponse): void {\n    this.state.available = data.available;\n    this.setLoading(false); // A reducer can call another reducer\n  }\n\n  // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n  @saga(SagaEffect.Latest)\n  *checkAvailability(productId: number) {\n    try {\n      yield this.setLoading(true);\n      const data: AvailabilityResponse = yield asyncGet(`/products/${productId}/availability`);\n      yield this.setData(data);\n    } catch (error) {\n      this.notificationService.error(error);\n    }\n  }\n}\n")),Object(r.b)("h2",{id:"next-step"},"Next step"),Object(r.b)("p",null,"The getting started tutorial is over. You should have now a good understanding on what Oneki.js can do to help you building enterprise application."))}b.isMDXComponent=!0}}]);