"use strict";(self.webpackChunkoneki_js=self.webpackChunkoneki_js||[]).push([[72603],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var a=n(67294),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=r().createContext({}),c=function(e){var t=r().useContext(u),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return r().createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r().createElement(r().Fragment,{},t)}},g=r().forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),g=a,h=p["".concat(i,".").concat(g)]||p[g]||d[g]||o;return n?r().createElement(h,s(s({ref:t},u),{},{components:n})):r().createElement(h,s({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=n[u];return r().createElement.apply(null,i)}return r().createElement.apply(null,n)}g.displayName="MDXCreateElement"},13919:function(e,t,n){function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function r(e){return void 0!==e&&!a(e)}n.d(t,{b:function(){return a},Z:function(){return r}})},44996:function(e,t,n){n.d(t,{C:function(){return o},Z:function(){return i}});var a=n(52263),r=n(13919);function o(){var e=(0,a.Z)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,n=void 0===t?"/":t,o=e.url;return{withBaseUrl:function(e,t){return function(e,t,n,a){var o=void 0===a?{}:a,i=o.forcePrependBaseUrl,s=void 0!==i&&i,l=o.absolute,u=void 0!==l&&l;if(!n)return n;if(n.startsWith("#"))return n;if((0,r.b)(n))return n;if(s)return t+n;var c=n.startsWith(t)?n:t+n.replace(/^\//,"");return u?e+c:c}(o,n,e,t)}}}function i(e,t){return void 0===t&&(t={}),(0,o().withBaseUrl)(e,t)}},58215:function(e,t,n){var a=n(67294),r=n.n(a);t.Z=function(e){var t=e.children,n=e.hidden,a=e.className;return r().createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},26396:function(e,t,n){n.d(t,{Z:function(){return g}});var a=n(83117),r=n(67294),o=n.n(r),i=n(72389),s=n(79443);var l=function(){var e=(0,r.useContext)(s.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},u=n(89521),c=n(86010),p="tabItem_1uMI";function d(e){var t,n,a,i=e.lazy,s=e.block,d=e.defaultValue,g=e.values,h=e.groupId,m=e.className,k=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=g?g:k.map((function(e){var t=e.props;return{value:t.value,label:t.label}})),v=(0,u.lx)(f,(function(e,t){return e.value===t.value}));if(v.length>0)throw new Error('Docusaurus error: Duplicate values "'+v.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===d?d:null!=(t=null!=d?d:null==(n=k.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(a=k[0])?void 0:a.props.value;if(null!==b&&!f.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var N=l(),x=N.tabGroupChoices,y=N.setTabGroupChoices,w=(0,r.useState)(b),T=w[0],j=w[1],E=[],O=(0,u.o5)().blockElementScrollPositionUntilNextRender;if(null!=h){var C=x[h];null!=C&&C!==T&&f.some((function(e){return e.value===C}))&&j(C)}var Z=function(e){var t=e.currentTarget,n=E.indexOf(t),a=f[n].value;a!==T&&(O(t),j(a),null!=h&&y(h,a))},A=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=E.indexOf(e.currentTarget)+1;n=E[a]||E[0];break;case"ArrowLeft":var r=E.indexOf(e.currentTarget)-1;n=E[r]||E[E.length-1]}null==(t=n)||t.focus()};return o().createElement("div",{className:"tabs-container"},o().createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,c.Z)("tabs",{"tabs--block":s},m)},f.map((function(e){var t=e.value,n=e.label;return o().createElement("li",{role:"tab",tabIndex:T===t?0:-1,"aria-selected":T===t,className:(0,c.Z)("tabs__item",p,{"tabs__item--active":T===t}),key:t,ref:function(e){return E.push(e)},onKeyDown:A,onFocus:Z,onClick:Z},null!=n?n:t)}))),i?(0,r.cloneElement)(k.filter((function(e){return e.props.value===T}))[0],{className:"margin-vert--md"}):o().createElement("div",{className:"margin-vert--md"},k.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==T})}))))}function g(e){var t=(0,i.Z)();return o().createElement(d,(0,a.Z)({key:String(t)},e))}},79443:function(e,t,n){var a=n(67294),r=(0,a.createContext)(void 0);t.Z=r},64094:function(e,t,n){var a=n(67294),r=n.n(a),o=n(26396);n(58215);t.Z=function(e){var t=e.children;return console.log("children",t),r().createElement(o.Z,{groupId:"application-types",defaultValue:"cra",values:[{label:"Create React App",value:"cra"},{label:"Nextjs App",value:"next"}]},t)}},32779:function(e,t,n){n.d(t,{Y:function(){return o}});var a=n(67294),r=n.n(a),o=function(e){var t=e.name;return r().createElement("div",{style:{textAlign:"right"}},r().createElement("a",{href:"https://codesandbox.io/s/github/oneki/onekijs/tree/master/examples/"+t,target:"_blank",style:{display:"inline-flex",alignItems:"center",height:"32px",padding:"0px 12px",fontSize:"13px",fontWeight:500,color:"rgb(255, 255, 255)",backgroundColor:"#2196f3",borderRadius:"4px",textDecoration:"none",cursor:"pointer",marginBottom:"2px"}},"Open in Codesandbox"))};t.Z=function(e){var t=e.name,n=e.height,a=void 0===n?500:n,o=e.modules,i=e.branch,s=void 0===i?"master":i,l=e.type,u=void 0===l?"examples":l,c=e.view,p="https://codesandbox.io/embed/github/oneki/onekijs/tree/"+s+"/"+u+"/"+t+"?codemirror=1&fontsize=14&theme=dark&view="+(void 0===c?"editor":c);o&&(p+="&module=",o.forEach((function(e,t){t>0&&(p+=","),p+=e})));var d="onekijs-"+t.split("/").join("-");return r().createElement("iframe",{src:p,style:{width:"100%",height:a+"px",border:0,bordeRadius:"4px",overflow:"hidden"},title:d,allow:"geolocation; microphone; camera; midi; accelerometer; gyroscope; payment; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"})}},44092:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return p},metadata:function(){return d},toc:function(){return g},default:function(){return m}});var a=n(83117),r=n(80102),o=(n(67294),n(3905)),i=(n(44996),n(64094)),s=n(58215),l=n(32779),u=["components"],c={id:"authentication",title:"Adding authentication",sidebar_label:"Adding authentication"},p=void 0,d={unversionedId:"getting-started/authentication",id:"getting-started/authentication",isDocsHomePage:!1,title:"Adding authentication",description:"This step consists in adding an authentication system to the application",source:"@site/docs/getting-started/005_authentication.md",sourceDirName:"getting-started",slug:"/getting-started/authentication",permalink:"/docs/getting-started/authentication",editUrl:"https://github.com/oneki/oneki.github.io/edit/source/docs/getting-started/005_authentication.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{id:"authentication",title:"Adding authentication",sidebar_label:"Adding authentication"},sidebar:"someSidebar",previous:{title:"Adding state management",permalink:"/docs/getting-started/global-state"},next:{title:"Managing data",permalink:"/docs/getting-started/data"}},g=[{value:"Final result",id:"final-result",children:[],level:2},{value:"Securing the cart page",id:"securing-the-cart-page",children:[],level:2},{value:"Adding a global configuration",id:"adding-a-global-configuration",children:[],level:2},{value:"Adding the login page",id:"adding-the-login-page",children:[{value:"Updating the Navbar to show the logged in user",id:"updating-the-navbar-to-show-the-logged-in-user",children:[],level:3}],level:2},{value:"Adding the logout page",id:"adding-the-logout-page",children:[{value:"Updating Navbar to display a logout link",id:"updating-navbar-to-display-a-logout-link",children:[],level:3}],level:2},{value:"Next step",id:"next-step",children:[],level:2}],h={toc:g};function m(e){var t=e.components,n=(0,r.Z)(e,u);return(0,o.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This step consists in adding an authentication system to the application"),(0,o.kt)("p",null,"Oneki.js provides an authentication library offering:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"several authentication methods (form based, oauth2, external login, ...)"),(0,o.kt)("li",{parentName:"ul"},"the restriction of access to pages to authenticated users only (can be based on roles)."),(0,o.kt)("li",{parentName:"ul"},"the provision of a security context accessible everywhere in the application. The security context contains data identifying the connected user (username, roles, ...).")),(0,o.kt)("h2",{id:"final-result"},"Final result"),(0,o.kt)("p",null,"The result of this step is as follows:"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"New in this step")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The shopping cart page (accessible via the checkout button) is now only for authenticated users.",(0,o.kt)("br",null),"\nIf you are not yet authenticated, you are redirected to the login page where you can log in."))),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"cra",mdxType:"TabItem"},(0,o.kt)(l.Z,{name:"step04-authentication",type:"getting-started/cra",view:"preview",height:"600",modules:["/src/index.tsx","/src/pages/products/index.tsx"],mdxType:"Sandbox"})),(0,o.kt)(s.Z,{value:"next",mdxType:"TabItem"},(0,o.kt)(l.Z,{name:"step04-authentication",type:"getting-started/next",view:"preview",height:"600",modules:["/src/pages/index.tsx","/src/pages/_app.tsx"],mdxType:"Sandbox"}))),(0,o.kt)("h2",{id:"securing-the-cart-page"},"Securing the cart page"),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Oneki.js provides several hooks to handle authentication",(0,o.kt)("br",null),"\nIn this tutorial, we will use these hooks:"),(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"useLogin")," returns a service handling the login phase. In our case, this is sending a POST request to /auth/login containing the username and password."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"useLogout")," returns a service managing the disconnection phase. In our case, sending a GET request to /auth/logout"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"useSecurityContext")," returns an object identifying the disconnected user.")))),(0,o.kt)("p",null,"To prevent an unauthenticated user from accessing the shopping cart page, you can use the HOC ",(0,o.kt)("strong",{parentName:"p"},"secure")," (to learn more about the HOC, ",(0,o.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/higher-order-components.html"},"click here"),")."),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"cra",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/cra/step04-authentication/src/pages/cart.tsx\n"))),(0,o.kt)(s.Z,{value:"next",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/next/step04-authentication/src/pages/cart.tsx\n")))),(0,o.kt)("p",null,"By default, an unauthenticated user is redirected to /login. ",(0,o.kt)("br",null),"However, this path can be configured via a global configuration introduced below."),(0,o.kt)("h2",{id:"adding-a-global-configuration"},"Adding a global configuration"),(0,o.kt)("p",null,"Oneki.js recommends to place the configuration settings in a central location. Usually the configuration is placed in the file ",(0,o.kt)("strong",{parentName:"p"},"src/settings.ts"),"."),(0,o.kt)("p",null,"Some components of the framework use the content of this file to configure themselves. This is the case for the ",(0,o.kt)("strong",{parentName:"p"},"secure")," HOC.",(0,o.kt)("br",null),"\nTo redirect the user to ",(0,o.kt)("strong",{parentName:"p"},"/auth")," instead of ",(0,o.kt)("strong",{parentName:"p"},"/login"),", create the file ",(0,o.kt)("inlineCode",{parentName:"p"},"src/settings.ts")," with the following content:"),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"cra",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/settings.ts"',title:'"src/settings.ts"'},"export default {\n  routes: {\n    // redirect to /auth if a non authenticated user\n    // tries to access a secured page\n    login: '/auth',\n  },\n} as AppSettings;\n")),(0,o.kt)("p",null),"and pass the configuration to ",(0,o.kt)("code",null,"<App/>"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/cra/step04-authentication/src/index.tsx\n"))),(0,o.kt)(s.Z,{value:"next",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/settings.ts"',title:'"src/settings.ts"'},"export default {\n  routes: {\n    // redirect to /auth if a non authenticated user\n    // tries to access a secured page\n    login: '/auth',\n  },\n} as AppSettings;\n")),(0,o.kt)("p",null),"and pass the configuration to ",(0,o.kt)("code",null,"<NextApp/>"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/next/step04-authentication/src/pages/_app.tsx\n")))),(0,o.kt)("h2",{id:"adding-the-login-page"},"Adding the login page"),(0,o.kt)("p",null,"The login page displays a very basic form containing two fields: ",(0,o.kt)("strong",{parentName:"p"},"username")," and ",(0,o.kt)("strong",{parentName:"p"},"password"),(0,o.kt)("br",null),"\nThe page uses the ",(0,o.kt)("strong",{parentName:"p"},"useLogin")," hook to handle the login phase which consists of:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"sending a POST ajax request containing the username / password to a server"),(0,o.kt)("li",{parentName:"ul"},"process the response by creating a security context and storing it in the global state. The content of the security context is the content of the response.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"useLogin")," also uses the global configuration ",(0,o.kt)("inlineCode",{parentName:"p"},"src/settings.ts")," to know:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"the type of authentication (form based, external, Oauth2, ...)"),(0,o.kt)("li",{parentName:"ul"},"the URL to use to send the POST request")),(0,o.kt)("p",null,"Let's first update the content of ",(0,o.kt)("inlineCode",{parentName:"p"},"src/settings.ts")),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"cra",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{5-17} title="src/settings.ts"',"{5-17}":!0,title:'"src/settings.ts"'},"export default {\n  routes: {\n    login: '/login',\n  },\n  idp: {\n    default: {\n      // We want to use a form based authentication\n      type: 'form',\n      // The URL to send the POST request containing\n      // username / password \n      loginEndpoint: '/auth/login',\n      // URL to retrieve the security context\n      // This URL is called to verify if the user\n      // is already authenticated or not\n      userinfoEndpoint: '/userinfo', \n    },\n  },\n} as AppSettings;\n")),(0,o.kt)("p",null),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The endpoints /auth/login, /auth/logout and /userinfo are mocked to simulate a backend server.",(0,o.kt)("br",null),"\nThe mocked server is defined in src/","_","_server__"),(0,o.kt)("p",{parentName:"div"},"You can check the documentation of the library ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://mswjs.io/"},"msw"))," to learn more about mocking a server inside a browser"))),(0,o.kt)("p",null),"Then create the auth page:",(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The auth page uses the hook ",(0,o.kt)("strong",{parentName:"p"},"useForm")," which is explained later in the step ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"./form"},"Adding form"))))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/cra/step04-authentication/src/pages/login.tsx\n")),(0,o.kt)("p",null),"Create a route to associate the ",(0,o.kt)("code",null,"<LoginPage/>")," to ",(0,o.kt)("b",null,"/login"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/cra/step04-authentication/src/pages/_router.tsx\n"))),(0,o.kt)(s.Z,{value:"next",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{5-17} title="src/settings.ts"',"{5-17}":!0,title:'"src/settings.ts"'},"export default {\n  routes: {\n    login: '/login',\n  },\n  idp: {\n    default: {\n      // We want to use a form based authentication\n      type: 'form',\n      // The URL to send the POST request containing\n      // username / password \n      loginEndpoint: '/api/auth/login',\n      // URL to retrieve the security context\n      // This URL is called to verify if the user\n      // is already authenticated or not\n      userinfoEndpoint: '/api/userinfo', \n    },\n  },\n} as AppSettings;\n")),(0,o.kt)("p",null),"Then create the auth page:",(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The auth page uses the ",(0,o.kt)("strong",{parentName:"p"},"useForm")," hook which is explained later in the step ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"./form"},"Adding form"))))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/next/step04-authentication/src/pages/login.tsx\n")))),(0,o.kt)("h3",{id:"updating-the-navbar-to-show-the-logged-in-user"},"Updating the Navbar to show the logged in user"),(0,o.kt)("p",null,"Now we want to show the username of the logged in user in the navigation bar.",(0,o.kt)("br",null),"\nWe can retrieve the username anywhere in the application via the ",(0,o.kt)("strong",{parentName:"p"},"useSecurityContext")," hook"),(0,o.kt)("p",null,"The content of the security context is the response sent by the backend when the userinfo endpoint is called.",(0,o.kt)("br",null),"In our case, the backend returns a very simple object containing only the username:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "username": "john.doe"\n}\n')),(0,o.kt)("p",null),"To display the username in the Navbar, update the ",(0,o.kt)("code",null,"<Navbar/>")," component:",(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"cra",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/cra/step04-authentication/src/modules/core/components/Navbar.tsx\n"))),(0,o.kt)(s.Z,{value:"next",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/next/step04-authentication/src/modules/core/components/Navbar.tsx\n")))),(0,o.kt)("h2",{id:"adding-the-logout-page"},"Adding the logout page"),(0,o.kt)("p",null,"We want to provide the user with a link to log out.",(0,o.kt)("br",null),"\nThe logout action calls the backend server to delete the cookie and clean up the security context from the global state."),(0,o.kt)("p",null,"This action is handled by the ",(0,o.kt)("strong",{parentName:"p"},"useLogout")," hook. This hook gets the logout endpoint from ",(0,o.kt)("inlineCode",{parentName:"p"},"src/settings.ts")),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"cra",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{9} title="src/settings.ts"',"{9}":!0,title:'"src/settings.ts"'},"export default {\n  routes: {\n    login: '/login',\n  },\n  idp: {\n    default: {\n      type: 'form', \n      loginEndpoint: '/auth/login',\n      logoutEndpoint: '/auth/logout',\n      userinfoEndpoint: '/userinfo', \n    },\n  },\n} as AppSettings;\n")),(0,o.kt)("p",null,"Create a logout page to handle the logout process.",(0,o.kt)("br",null),"\nBy default, the ",(0,o.kt)("strong",{parentName:"p"},"useLogout")," hook sends a GET request to the backend server"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/cra/step04-authentication/src/pages/logout.tsx\n")),(0,o.kt)("p",null,"Update the router to take into account this new page"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{7-9} title="src/pages/_router.tsx"',"{7-9}":!0,title:'"src/pages/_router.tsx"'},'const RootRouter = (): JSX.Element => {\n  return (\n    <Switch>\n      <Route path="/login">\n        <LoginPage />\n      </Route>\n      <Route path="/logout">\n        <LogoutPage />\n      </Route>\n      <Route>\n        <AppLayout>\n          <Switch>\n            <Route path="/products">\n              <ProductsRouter />\n            </Route>\n            <Route path="/cart">\n              <CartPage />\n            </Route>\n            <Route>\n              <Redirect href="/products" />\n            </Route>\n          </Switch>\n        </AppLayout>\n      </Route>\n    </Switch>\n  );\n};\n\nexport default RootRouter;\n'))),(0,o.kt)(s.Z,{value:"next",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{9} title="src/settings.ts"',"{9}":!0,title:'"src/settings.ts"'},"export default {\n  routes: {\n    login: '/login',\n  },\n  idp: {\n    default: {\n      type: 'form', \n      loginEndpoint: '/api/auth/login',\n      logoutEndpoint: '/api/auth/logout',\n      userinfoEndpoint: '/api/userinfo', \n    },\n  },\n} as AppSettings;\n")),(0,o.kt)("p",null,"Create a logout page to handle the logout process.",(0,o.kt)("br",null),"\nBy default, the ",(0,o.kt)("strong",{parentName:"p"},"useLogout")," hook sends a GET request to the backend server"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"reference",reference:!0},"https://github.com/oneki/onekijs/blob/master/getting-started/next/step04-authentication/src/pages/logout.tsx\n")))),(0,o.kt)("h3",{id:"updating-navbar-to-display-a-logout-link"},"Updating Navbar to display a logout link"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{12-14} title="src/modules/core/components/Navbar.tsx"',"{12-14}":!0,title:'"src/modules/core/components/Navbar.tsx"'},'const Navbar: FC = () => {\n  const [loggedUser] = useSecurityContext(\'username\');\n  return (\n    <div className="app-top-bar">\n      <Link href="/">\n        <h1>My Store</h1>\n      </Link>\n      <div className="app-top-bar-right">\n        {loggedUser && (\n          <div className="user">\n            {loggedUser}{\' \'}\n            <Link className="logout" href="/logout">\n              [Log out]\n            </Link>\n          </div>\n        )}\n        <Link href="/cart" className="button fancy-button">\n          <i className="material-icons">shopping_cart</i>\n          Checkout\n        </Link>\n      </div>\n    </div>\n  );\n};\n\nexport default Navbar;\n')),(0,o.kt)("h2",{id:"next-step"},"Next step"),(0,o.kt)("p",null,"Now that we can identify the logged-in user, we can save the cart contents in the cloud so we don't lose its contents after a refresh",(0,o.kt)("br",null),"\n",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"data"},"In the next step")),", we introduce the services offered by Oneki.js to retrieve and send data via AJAX requests."))}m.isMDXComponent=!0}}]);