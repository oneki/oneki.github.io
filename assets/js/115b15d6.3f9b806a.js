"use strict";(self.webpackChunkoneki_js=self.webpackChunkoneki_js||[]).push([[5706],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var r=n(7294),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o().createContext({}),d=function(e){var t=o().useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=d(e.components);return o().createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o().createElement(o().Fragment,{},t)}},m=o().forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=d(n),m=r,h=u["".concat(i,".").concat(m)]||u[m]||p[m]||a;return n?o().createElement(h,s(s({ref:t},l),{},{components:n})):o().createElement(h,s({ref:t},l))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<a;l++)i[l]=n[l];return o().createElement.apply(null,i)}return o().createElement.apply(null,n)}m.displayName="MDXCreateElement"},3919:function(e,t,n){function r(e){return!0===/^(\w*:|\/\/)/.test(e)}function o(e){return void 0!==e&&!r(e)}n.d(t,{b:function(){return r},Z:function(){return o}})},4996:function(e,t,n){n.d(t,{C:function(){return a},Z:function(){return i}});var r=n(2263),o=n(3919);function a(){var e=(0,r.Z)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,n=void 0===t?"/":t,a=e.url;return{withBaseUrl:function(e,t){return function(e,t,n,r){var a=void 0===r?{}:r,i=a.forcePrependBaseUrl,s=void 0!==i&&i,c=a.absolute,l=void 0!==c&&c;if(!n)return n;if(n.startsWith("#"))return n;if((0,o.b)(n))return n;if(s)return t+n;var d=n.startsWith(t)?n:t+n.replace(/^\//,"");return l?e+d:d}(a,n,e,t)}}}function i(e,t){return void 0===t&&(t={}),(0,a().withBaseUrl)(e,t)}},8215:function(e,t,n){var r=n(7294),o=n.n(r);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return o().createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},5064:function(e,t,n){n.d(t,{Z:function(){return p}});var r=n(7294),o=n.n(r),a=n(9443);var i=function(){var e=(0,r.useContext)(a.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},s=n(6010),c="tabItem_1uMI",l="tabItemActive_2DSg";var d=37,u=39;var p=function(e){var t=e.lazy,n=e.block,a=e.defaultValue,p=e.values,m=e.groupId,h=e.className,v=i(),g=v.tabGroupChoices,f=v.setTabGroupChoices,k=(0,r.useState)(a),y=k[0],b=k[1],w=r.Children.toArray(e.children),N=[];if(null!=m){var x=g[m];null!=x&&x!==y&&p.some((function(e){return e.value===x}))&&b(x)}var P=function(e){var t=e.currentTarget,n=N.indexOf(t),r=p[n].value;b(r),null!=m&&(f(m,r),setTimeout((function(){var e,n,r,o,a,i,s,c;(e=t.getBoundingClientRect(),n=e.top,r=e.left,o=e.bottom,a=e.right,i=window,s=i.innerHeight,c=i.innerWidth,n>=0&&a<=c&&o<=s&&r>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(l),setTimeout((function(){return t.classList.remove(l)}),2e3))}),150))},C=function(e){var t,n;switch(e.keyCode){case u:var r=N.indexOf(e.target)+1;n=N[r]||N[0];break;case d:var o=N.indexOf(e.target)-1;n=N[o]||N[N.length-1]}null==(t=n)||t.focus()};return o().createElement("div",{className:"tabs-container"},o().createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":n},h)},p.map((function(e){var t=e.value,n=e.label;return o().createElement("li",{role:"tab",tabIndex:y===t?0:-1,"aria-selected":y===t,className:(0,s.Z)("tabs__item",c,{"tabs__item--active":y===t}),key:t,ref:function(e){return N.push(e)},onKeyDown:C,onFocus:P,onClick:P},n)}))),t?(0,r.cloneElement)(w.filter((function(e){return e.props.value===y}))[0],{className:"margin-vert--md"}):o().createElement("div",{className:"margin-vert--md"},w.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==y})}))))}},9443:function(e,t,n){var r=n(7294),o=(0,r.createContext)(void 0);t.Z=o},4094:function(e,t,n){var r=n(7294),o=n.n(r),a=n(5064);n(8215);t.Z=function(e){var t=e.children;return console.log("children",t),o().createElement(a.Z,{groupId:"application-types",defaultValue:"cra",values:[{label:"Create React App",value:"cra"},{label:"Nextjs App",value:"next"}]},t)}},2779:function(e,t,n){var r=n(7294),o=n.n(r);t.Z=function(e){var t=e.name,n=e.height,r=void 0===n?500:n,a=e.modules,i=e.branch,s=void 0===i?"master":i,c=e.type,l=void 0===c?"example":c,d=e.view,u="https://codesandbox.io/embed/github/oneki/onekijs/tree/"+s+"/"+l+"/"+t+"?codemirror=1&fontsize=14&theme=dark&view="+(void 0===d?"editor":d);a&&(u+="&module=",a.forEach((function(e,t){t>0&&(u+=","),u+=e})));var p="onekijs-"+t.split("/").join("-");return o().createElement("iframe",{src:u,style:{width:"100%",height:r+"px",border:0,bordeRadius:"4px",overflow:"hidden"},title:p,allow:"geolocation; microphone; camera; midi; accelerometer; gyroscope; payment; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"})}},5403:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return l},metadata:function(){return d},toc:function(){return u},default:function(){return m}});var r=n(3117),o=n(102),a=(n(7294),n(3905)),i=(n(4996),n(4094),n(8215),n(2779)),s=["components"],c={id:"error-handling",title:"Handling errors",sidebar_label:"Handling errors"},l=void 0,d={unversionedId:"overview/getting-started/error-handling",id:"overview/getting-started/error-handling",isDocsHomePage:!1,title:"Handling errors",description:"Two types of error can occur:",source:"@site/docs/overview/getting-started/008_error-handling.md",sourceDirName:"overview/getting-started",slug:"/overview/getting-started/error-handling",permalink:"/docs/overview/getting-started/error-handling",editUrl:"https://github.com/oneki/oneki.github.io/edit/source/docs/overview/getting-started/008_error-handling.md",version:"current",sidebarPosition:8,frontMatter:{id:"error-handling",title:"Handling errors",sidebar_label:"Handling errors"},sidebar:"someSidebar",previous:{title:"Centralizing notifications",permalink:"/docs/overview/getting-started/notification"},next:{title:"Internationalization",permalink:"/docs/overview/getting-started/i18n"}},u=[{value:"Final result",id:"final-result",children:[]},{value:"Error boundaries",id:"error-boundaries",children:[]},{value:"Error handling",id:"error-handling",children:[{value:"Uncaught errors",id:"uncaught-errors",children:[]}]},{value:"Next step",id:"next-step",children:[]}],p={toc:u};function m(e){var t=e.components,n=(0,o.Z)(e,s);return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Two types of error can occur:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The ones throwed during the rendering of a component. To handle this type of errors, React recommends to implement ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("a",{parentName:"strong",href:"https://reactjs.org/docs/error-boundaries.html"},"Error Boundaries"))),(0,a.kt)("li",{parentName:"ul"},"The standard ones throwed by your javascript code (try/catch) or returned by the server")),(0,a.kt)("p",null,"This step consists in handling these type of errors."),(0,a.kt)("h2",{id:"final-result"},"Final result"),(0,a.kt)("p",null,"The result of this step is as follows:"),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"New in this step")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},'The third product is now named "Invalid product". A click on this product simulate an error during the rendering of the page.',(0,a.kt)("br",null),'\nThe "Buy" button now calls an API that returns an HTTP 400 error indicating that the product is not available at the moment'))),(0,a.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Codesandbox executes the project in dev mode. Therefore, the ",(0,a.kt)("inlineCode",{parentName:"p"},"<ErrorBoundary />")," component is hidden by the stacktrace displayed by create react app",(0,a.kt)("br",null),'\nJust press "ESC" to hide this stacktrace.'))),(0,a.kt)(i.Z,{name:"step07-error-handling",type:"getting-started/cra",view:"preview",height:"600",modules:["/src/index.tsx","/src/pages/products/index.tsx"],mdxType:"Sandbox"}),(0,a.kt)("h2",{id:"error-boundaries"},"Error boundaries"),(0,a.kt)("p",null,"You can pass a component to ",(0,a.kt)("inlineCode",{parentName:"p"},"<App />")," (via the prop ",(0,a.kt)("inlineCode",{parentName:"p"},"ErrorBoundaryComponent"),"). This component will be called when an error occurs during the rendering.",(0,a.kt)("br",null),"\nFirst, let's create this component"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/modules/core/components/ErrorBoundary.tsx"',title:'"src/modules/core/components/ErrorBoundary.tsx"'},'const ErrorBoundary: FC<ErrorBoundaryComponentProps> = ({ error, errorInfo }) => {\n  return (\n    <div className="error-boundary-container">\n      <div>\n        <div className="error">An error occured: {error?.message}</div>\n        <div>\n          stacktrace: <pre>{errorInfo?.componentStack}</pre>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ErrorBoundary;\n')),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"This component has access to the application context. It means you can use any Oneki hooks in this component (e.g: useGlobalState)"))),(0,a.kt)("p",null,"Update the entry point to pass this component to ",(0,a.kt)("inlineCode",{parentName:"p"},"<App />")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{2} title="src/index.tsx"',"{2}":!0,title:'"src/index.tsx"'},"ReactDOM.render(\n  <App settings={settings} ErrorBoundaryComponent={ErrorBoundary}>\n    <RootRouter />\n  </App>,\n  document.getElementById('root'),\n);\n")),(0,a.kt)("p",null,'To simulate an error during the rendering phase, update the product details page to simulate an error when the product name is "Phone Invalid":'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{13-16} title="src/pages/products/[id]/index.tsx"',"{13-16}":!0,title:'"src/pages/products/[id]/index.tsx"'},"const ProductDetailsPage: FC = () => {\n  const { id } = useParams();\n  const [submit] = usePost<ProductType>(URL_ADD_PRODUCT, {\n    onSuccess: () => {\n      window.alert('Product added succesfully to the cart!');\n    },\n    onError: (error) => {\n      window.alert(`An error occured while adding the product to the cart: ${error.message}`);\n    },\n  });\n\n  let product = products[+id];\n  if (product.name === 'Phone Invalid') {\n    // to simulate an error, we pickup a entry that doesn't exist\n    product = products[9999];\n  }\n  return (\n    <div>\n      <ProductDetails product={product} onBuy={() => submit(product)} />\n    </div>\n  );\n};\n\nexport default ProductDetailsPage;\n")),(0,a.kt)("p",null,'Now when rendering the product named "Phone Invalid", the product is undefined and the component ErrorBoundary is displayed',(0,a.kt)("br",null),"\nIf you display another product, everything is working as before."),(0,a.kt)("h2",{id:"error-handling"},"Error handling"),(0,a.kt)("p",null,"When an error occurs, we recommend to display them via the ",(0,a.kt)("inlineCode",{parentName:"p"},"<NotificationCenter />"),".",(0,a.kt)("br",null),"\nTo simulate an error coming from the server, a new API is exposed by the server that returns an HTTP 400 response with the following body:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "message": "The product ${req.body.name} is not available at this moment"\n}\n')),(0,a.kt)("p",null,"Update the ",(0,a.kt)("inlineCode",{parentName:"p"},"Product details page")," to call this new API and to use ",(0,a.kt)("inlineCode",{parentName:"p"},"NotificationService")," instead of ",(0,a.kt)("inlineCode",{parentName:"p"},"window.alert"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{2} title="src/modules/core/libs/constants.ts"',"{2}":!0,title:'"src/modules/core/libs/constants.ts"'},"export const STATE_CART = 'cart';\nexport const URL_ADD_PRODUCT = '/cart/products-not-available';\nexport const URL_CART = '/cart';\nexport const NOTIF_TOPIC_ERROR = 'error';\nexport const NOTIF_TOPIC_SUCCESS = 'success';\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{5-11} title="src/pages/products/[id]/index.tsx"',"{5-11}":!0,title:'"src/pages/products/[id]/index.tsx"'},"const ProductDetailsPage: FC = () => {\n  const { id } = useParams();\n  const notificationService = useNotificationService();\n  const [submit] = usePost<ProductType>(URL_ADD_PRODUCT, {\n    onError: (error) => {\n      notificationService.error({\n        payload: {\n          message: error.message,\n        },\n      });\n    },\n  });\n\n  let product = products[+id];\n  if (product.name === 'Phone Invalid') {\n    // to simulate an error, we pickup a non entry in the array\n    product = products[9999];\n  }\n  return (\n    <div>\n      <ProductDetails product={product} onBuy={() => submit(product)} />\n    </div>\n  );\n};\n\nexport default ProductDetailsPage;\n")),(0,a.kt)("p",null,'Now, when you click on the button "Buy", an error notification is shown.'),(0,a.kt)("h3",{id:"uncaught-errors"},"Uncaught errors"),(0,a.kt)("p",null,"When using an Oneki.js hook, if you don't specify a callback to handle errors, it will automatically send the following notification:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n  topic: 'error',\n  payload: {\n    message: ${error.message}\n  }\n  ...\n}\n")),(0,a.kt)("p",null,"Therefore, we can update the ",(0,a.kt)("inlineCode",{parentName:"p"},"Product details page")," and remove the onError callback:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/pages/products/[id]/index.tsx"',title:'"src/pages/products/[id]/index.tsx"'},"const ProductDetailsPage: FC = () => {\n  const { id } = useParams();\n  const notificationService = useNotificationService();\n  const [submit] = usePost<ProductType>(URL_ADD_PRODUCT);\n\n  let product = products[+id];\n  if (product.name === 'Phone Invalid') {\n    // to simulate an error, we pickup a non entry in the array\n    product = products[9999];\n  }\n  return (\n    <div>\n      <ProductDetails product={product} onBuy={() => submit(product)} />\n    </div>\n  );\n};\n\nexport default ProductDetailsPage;\n")),(0,a.kt)("h2",{id:"next-step"},"Next step"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("a",{parentName:"strong",href:"i18n"},"In the next step")),", we adapt the application to different languages (internationalization and localization)."))}m.isMDXComponent=!0},6010:function(e,t,n){function r(e){var t,n,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=r(e[t]))&&(o&&(o+=" "),o+=n);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}function o(){for(var e,t,n=0,o="";n<arguments.length;)(e=arguments[n++])&&(t=r(e))&&(o&&(o+=" "),o+=t);return o}n.d(t,{Z:function(){return o}})}}]);