"use strict";(self.webpackChunkoneki_js=self.webpackChunkoneki_js||[]).push([[3536],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return m}});var n=a(7294),i=a.n(n);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var c=i().createContext({}),d=function(e){var t=i().useContext(c),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=d(e.components);return i().createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i().createElement(i().Fragment,{},t)}},v=i().forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=d(a),v=n,m=u["".concat(o,".").concat(v)]||u[v]||p[v]||r;return a?i().createElement(m,l(l({ref:t},c),{},{components:a})):i().createElement(m,l({ref:t},c))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,o=new Array(r);o[0]=v;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var c=2;c<r;c++)o[c]=a[c];return i().createElement.apply(null,o)}return i().createElement.apply(null,a)}v.displayName="MDXCreateElement"},3919:function(e,t,a){function n(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!n(e)}a.d(t,{b:function(){return n},Z:function(){return i}})},4996:function(e,t,a){a.d(t,{C:function(){return r},Z:function(){return o}});var n=a(2263),i=a(3919);function r(){var e=(0,n.Z)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,a=void 0===t?"/":t,r=e.url;return{withBaseUrl:function(e,t){return function(e,t,a,n){var r=void 0===n?{}:n,o=r.forcePrependBaseUrl,l=void 0!==o&&o,s=r.absolute,c=void 0!==s&&s;if(!a)return a;if(a.startsWith("#"))return a;if((0,i.b)(a))return a;if(l)return t+a;var d=a.startsWith(t)?a:t+a.replace(/^\//,"");return c?e+d:d}(r,a,e,t)}}}function o(e,t){return void 0===t&&(t={}),(0,r().withBaseUrl)(e,t)}},8215:function(e,t,a){var n=a(7294),i=a.n(n);t.Z=function(e){var t=e.children,a=e.hidden,n=e.className;return i().createElement("div",{role:"tabpanel",hidden:a,className:n},t)}},5064:function(e,t,a){a.d(t,{Z:function(){return p}});var n=a(7294),i=a.n(n),r=a(9443);var o=function(){var e=(0,n.useContext)(r.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},l=a(6010),s="tabItem_1uMI",c="tabItemActive_2DSg";var d=37,u=39;var p=function(e){var t=e.lazy,a=e.block,r=e.defaultValue,p=e.values,v=e.groupId,m=e.className,h=o(),g=h.tabGroupChoices,b=h.setTabGroupChoices,f=(0,n.useState)(r),k=f[0],y=f[1],N=n.Children.toArray(e.children),w=[];if(null!=v){var x=g[v];null!=x&&x!==k&&p.some((function(e){return e.value===x}))&&y(x)}var A=function(e){var t=e.currentTarget,a=w.indexOf(t),n=p[a].value;y(n),null!=v&&(b(v,n),setTimeout((function(){var e,a,n,i,r,o,l,s;(e=t.getBoundingClientRect(),a=e.top,n=e.left,i=e.bottom,r=e.right,o=window,l=o.innerHeight,s=o.innerWidth,a>=0&&r<=s&&i<=l&&n>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(c),setTimeout((function(){return t.classList.remove(c)}),2e3))}),150))},S=function(e){var t,a;switch(e.keyCode){case u:var n=w.indexOf(e.target)+1;a=w[n]||w[0];break;case d:var i=w.indexOf(e.target)-1;a=w[i]||w[w.length-1]}null==(t=a)||t.focus()};return i().createElement("div",{className:"tabs-container"},i().createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":a},m)},p.map((function(e){var t=e.value,a=e.label;return i().createElement("li",{role:"tab",tabIndex:k===t?0:-1,"aria-selected":k===t,className:(0,l.Z)("tabs__item",s,{"tabs__item--active":k===t}),key:t,ref:function(e){return w.push(e)},onKeyDown:S,onFocus:A,onClick:A},a)}))),t?(0,n.cloneElement)(N.filter((function(e){return e.props.value===k}))[0],{className:"margin-vert--md"}):i().createElement("div",{className:"margin-vert--md"},N.map((function(e,t){return(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==k})}))))}},9443:function(e,t,a){var n=a(7294),i=(0,n.createContext)(void 0);t.Z=i},4094:function(e,t,a){var n=a(7294),i=a.n(n),r=a(5064);a(8215);t.Z=function(e){var t=e.children;return console.log("children",t),i().createElement(r.Z,{groupId:"application-types",defaultValue:"cra",values:[{label:"Create React App",value:"cra"},{label:"Nextjs App",value:"next"}]},t)}},2779:function(e,t,a){var n=a(7294),i=a.n(n);t.Z=function(e){var t=e.name,a=e.height,n=void 0===a?500:a,r=e.modules,o=e.branch,l=void 0===o?"master":o,s=e.type,c=void 0===s?"example":s,d=e.view,u="https://codesandbox.io/embed/github/oneki/onekijs/tree/"+l+"/"+c+"/"+t+"?codemirror=1&fontsize=14&theme=dark&view="+(void 0===d?"editor":d);r&&(u+="&module=",r.forEach((function(e,t){t>0&&(u+=","),u+=e})));var p="onekijs-"+t.split("/").join("-");return i().createElement("iframe",{src:u,style:{width:"100%",height:n+"px",border:0,bordeRadius:"4px",overflow:"hidden"},title:p,allow:"geolocation; microphone; camera; midi; accelerometer; gyroscope; payment; encrypted-media; usb",sandbox:"allow-modals allow-forms allow-popups allow-scripts allow-same-origin"})}},3885:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return d},toc:function(){return u},default:function(){return v}});var n=a(3117),i=a(102),r=(a(7294),a(3905)),o=(a(4996),a(4094),a(8215),a(2779)),l=["components"],s={id:"service",title:"Adding a service",sidebar_label:"Adding a service"},c=void 0,d={unversionedId:"overview/getting-started/service",id:"overview/getting-started/service",isDocsHomePage:!1,title:"Adding a service",description:"This step consists in creating its own service.",source:"@site/docs/overview/getting-started/011_service.md",sourceDirName:"overview/getting-started",slug:"/overview/getting-started/service",permalink:"/docs/overview/getting-started/service",editUrl:"https://github.com/oneki/oneki.github.io/edit/source/docs/overview/getting-started/011_service.md",version:"current",sidebarPosition:11,frontMatter:{id:"service",title:"Adding a service",sidebar_label:"Adding a service"},sidebar:"someSidebar",previous:{title:"Using form for user input",permalink:"/docs/overview/getting-started/form"},next:{title:"Application",permalink:"/docs/overview/app"}},u=[{value:"Final result",id:"final-result",children:[]},{value:"Creating a service",id:"creating-a-service",children:[{value:"Adding reducers",id:"adding-reducers",children:[]},{value:"Adding sagas",id:"adding-sagas",children:[]}]},{value:"Using the service",id:"using-the-service",children:[]},{value:"Handling error",id:"handling-error",children:[]},{value:"Next step",id:"next-step",children:[]}],p={toc:u};function v(e){var t=e.components,a=(0,i.Z)(e,l);return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This step consists in creating its own service."),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The topic on this page is intended for advanced use cases.",(0,r.kt)("br",null),"\nYou will implement a service when you need to add some advanced logic to your application"))),(0,r.kt)("p",null,"Almost all things provided by Oneki.js are based on services.",(0,r.kt)("br",null),"\nThe role of a service is to mutate a state. This state can be "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'a component state. In this case, the service is called a "local services"',(0,r.kt)("br",null),"\nExample of hooks exposing a local service: ",(0,r.kt)("inlineCode",{parentName:"li"},"useGet"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"usePost"),", ..."),(0,r.kt)("li",{parentName:"ul"},"the global redux state. In this case, the service is called a global service.",(0,r.kt)("br",null),"\nExample of hooks exposing global services: ",(0,r.kt)("inlineCode",{parentName:"li"},"useNotificationService"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"useSecurityContext"))),(0,r.kt)("p",null,"The service mutates the state following the best practices (immutability, action, reducers, ...)",(0,r.kt)("br",null),"\nTo mutate the state, it exposes two types of methods:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Reducer methods")," (annoted with @reducer). Only these methods can mutate the state."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Saga methods")," (annotate with @saga). These methods can orchestrate calls to reducer methods and are used to handle complex scenario like:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Calling a reducer to update a loading variable"),(0,r.kt)("li",{parentName:"ul"},"Let React rendering the component to display the loading indicator"),(0,r.kt)("li",{parentName:"ul"},"Perform a AJAX request asynchronously"),(0,r.kt)("li",{parentName:"ul"},"Store the result in the state (by calling another reducer method)"),(0,r.kt)("li",{parentName:"ul"},"Calling the first reducer to update the loading variable")))),(0,r.kt)("h2",{id:"final-result"},"Final result"),(0,r.kt)("p",null,"The result of this step is as follows:"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"New in this step")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},'The product detail page now displays a new button "Check Availability"',(0,r.kt)("br",null),"\nWhen you click on this button, the application calls the server to verify if the product is available or not"))),(0,r.kt)(o.Z,{name:"step10-service",type:"getting-started/cra",view:"preview",height:"600",modules:["/src/index.tsx","/src/pages/products/index.tsx"],mdxType:"Sandbox"}),(0,r.kt)("h2",{id:"creating-a-service"},"Creating a service"),(0,r.kt)("p",null,"We want to add a button on the product page to check its availability. A click on the button triggers the following scenario:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Add a loading indicator on the button"),(0,r.kt)("li",{parentName:"ol"},"Disable the button"),(0,r.kt)("li",{parentName:"ol"},"Perform a request to the server to check the availability"),(0,r.kt)("li",{parentName:"ol"},"Display the result on the product page next to the button:"),(0,r.kt)("li",{parentName:"ol"},"Remove the loading indicator"),(0,r.kt)("li",{parentName:"ol"},"Enable the button")),(0,r.kt)("p",null,"Therefore, the state contains the following elements:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/modules/products/services/AvailabilityService.ts"',title:'"src/modules/products/services/AvailabilityService.ts"'},"export interface AvailabilityState {\n  // a flag to indicate if a request is in flight\n  loading: boolean;\n\n  // the result of the request\n  // initial value is undefined\n  available?: boolean; // number of products available\n}\n\n// Reponse returned by the server\ninterface AvailabilityResponse {\n  available: boolean; // number of products available\n}\n")),(0,r.kt)("p",null,"Let's create a service to manipulate this state.",(0,r.kt)("br",null),"\nA service is a class that extends ",(0,r.kt)("inlineCode",{parentName:"p"},"LocalService")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"GlobalService"),". In our case, the state is local to a component and therefore the class extends ",(0,r.kt)("inlineCode",{parentName:"p"},"LocalService")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The class must be annotated with @service. This is something specific to Typescript that allows Oneki.js to create a proxy of this class at runtime."),(0,r.kt)("p",{parentName:"div"},"If you don't use Typescript, please check this page"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/modules/products/services/AvailabilityService.ts"',title:'"src/modules/products/services/AvailabilityService.ts"'},"@service\nexport default class AvailabilityService extends LocalService<AvailabilityState> {\n  //TODO implementation\n}\n")),(0,r.kt)("h3",{id:"adding-reducers"},"Adding reducers"),(0,r.kt)("p",null,"As explained above, the service contains two types of method: ",(0,r.kt)("inlineCode",{parentName:"p"},"reducer")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"saga")),(0,r.kt)("p",null,"For our service, we need two reducers:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A reducer method to mutate the field ",(0,r.kt)("inlineCode",{parentName:"li"},"loading")),(0,r.kt)("li",{parentName:"ul"},"A reducer method to mutate the field ",(0,r.kt)("inlineCode",{parentName:"li"},"available"))),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Reducer methods must be annotated with @reducer"))),(0,r.kt)("p",null,"Let's add these two methods:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'{3-14} title="src/modules/products/services/AvailabilityService.ts"',"{3-14}":!0,title:'"src/modules/products/services/AvailabilityService.ts"'},"@service\nexport default class AvailabilityService extends LocalService<AvailabilityState> {\n  @reducer\n  setLoading(loading: boolean): void {\n    // the state is immutable\n    // however, the @reducer annotation allows updating the state\n    // like any other object (thanks to immer)\n    this.state.loading = loading;\n  }\n\n  @reducer\n  setData(data: AvailabilityResponse): void {\n    this.state.available = data.available;\n    this.setLoading(false); // A reducer can call another reducer\n  }\n}\n")),(0,r.kt)("h3",{id:"adding-sagas"},"Adding sagas"),(0,r.kt)("p",null,"For our service, we need one saga that will implement the following scenario:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Update loading to ",(0,r.kt)("inlineCode",{parentName:"li"},"true")),(0,r.kt)("li",{parentName:"ol"},"Perform a request to the server to check the availability"),(0,r.kt)("li",{parentName:"ol"},"Set the result of the request in the state"),(0,r.kt)("li",{parentName:"ol"},"Update loading to ",(0,r.kt)("inlineCode",{parentName:"li"},"false"))),(0,r.kt)("p",null,"Let's add this method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'{18-23} title="src/modules/products/services/AvailabilityService.ts"',"{18-23}":!0,title:'"src/modules/products/services/AvailabilityService.ts"'},"@service\nexport default class AvailabilityService extends LocalService<AvailabilityState> {\n  @reducer\n  setLoading(loading: boolean): void {\n    // the state is immutable\n    // however, the @reducer annotation allows updating the state\n    // like any other object (thanks to immer)\n    this.state.loading = loading;\n  }\n\n  @reducer\n  setData(data: AvailabilityResponse): void {\n    this.state.available = data.available;\n    this.setLoading(false); // A reducer can call another reducer\n  }\n\n  // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n  @saga(SagaEffect.Latest)\n  *checkAvailability(productId: number) {\n    yield this.setLoading(true);\n    const data: AvailabilityResponse = yield asyncGet(`/products/${productId}/availability`);\n    yield this.setData(data);\n  }\n}\n")),(0,r.kt)("h2",{id:"using-the-service"},"Using the service"),(0,r.kt)("p",null,"To instantiate this service, Oneki.js proposes the hooks ",(0,r.kt)("inlineCode",{parentName:"p"},"useLocalService")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"useGlobalService"),(0,r.kt)("br",null),"\nAs we created a local service, we must use ",(0,r.kt)("inlineCode",{parentName:"p"},"useLocalService"),":"),(0,r.kt)("p",null,"Let's upadte the ",(0,r.kt)("inlineCode",{parentName:"p"},"ProductDetails")," component to add a button ",(0,r.kt)("inlineCode",{parentName:"p"},"Check Availability")," that uses the service:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'{1-3,7,30-50} title="src/modules/products/components/ProductDetails.ts"',"{1-3,7,30-50}":!0,title:'"src/modules/products/components/ProductDetails.ts"'},'const initialAvailabilityState: AvailabilityState = {\n  loading: false,\n};\n\nconst ProductDetails: FC<ProductDetailsProps> = ({ product, onBuy }) => {\n  const [T] = useTranslation();\n  const [availability, availabilityService] = useLocalService(AvailabilityService, initialAvailabilityState);\n  return (\n    <div>\n      <h2>\n        <T>Product Details</T>\n      </h2>\n\n      <div>\n        <h3>\n          <T>{product.name}</T>\n        </h3>\n        <h4>\n          <T>{currency(product.price)}</T>\n        </h4>\n        <p>\n          <T>{product.description}</T>\n        </p>\n        <p>\n          <button onClick={onBuy}>\n            <T>Buy</T>\n          </button>\n        </p>\n        <p>\n          <button onClick={() => availabilityService.checkAvailability(product.id)} disabled={availability.loading}>\n            <T>Check availability</T>\n          </button>\n          <span className="availability">\n            {availability.loading && (\n              <span>\n                <T>Loading</T> ...\n              </span>\n            )}\n            {!availability.loading && availability.available === true && (\n              <span className="available">\n                <T>The product is available</T>\n              </span>\n            )}\n            {!availability.loading && availability.available === false && (\n              <span className="not-available">\n                <T>The product is not available</T>\n              </span>\n            )}\n          </span>\n        </p>\n      </div>\n    </div>\n  );\n};\n\nexport default ProductDetails;\n')),(0,r.kt)("h2",{id:"handling-error"},"Handling error"),(0,r.kt)("p",null,"We can improve the service to handle correctly the errors returned by the server.",(0,r.kt)("br",null),"\nOne common approch is to send a notification on the topic ",(0,r.kt)("inlineCode",{parentName:"p"},"error")," so the ",(0,r.kt)("inlineCode",{parentName:"p"},"<NotificationCenter />")," automatically displays it"),(0,r.kt)("p",null,"To be able to use the NotificationService inside the AvailabilityService, one must inject it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'{3,22,26-28} title="src/modules/products/services/AvailabilityService.ts"',"{3,22,26-28}":!0,title:'"src/modules/products/services/AvailabilityService.ts"'},"@service\nexport default class AvailabilityService extends LocalService<AvailabilityState> {\n  notificationService = inject(NotificationService);\n\n  @reducer\n  setLoading(loading: boolean): void {\n    // the state is immutable\n    // however, the @reducer annotation allows updating the state\n    // like any other object (thanks to immer)\n    this.state.loading = loading;\n  }\n\n  @reducer\n  setData(data: AvailabilityResponse): void {\n    this.state.available = data.available;\n    this.setLoading(false); // A reducer can call another reducer\n  }\n\n  // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n  @saga(SagaEffect.Latest)\n  *checkAvailability(productId: number) {\n    try {\n      yield this.setLoading(true);\n      const data: AvailabilityResponse = yield asyncGet(`/products/${productId}/availability`);\n      yield this.setData(data);\n    } catch (error) {\n      this.notificationService.error(error);\n    }\n  }\n}\n")),(0,r.kt)("h2",{id:"next-step"},"Next step"),(0,r.kt)("p",null,"The getting started tutorial is over. You should have now a good understanding on what Oneki.js can do to help you building enterprise application."))}v.isMDXComponent=!0},6010:function(e,t,a){function n(e){var t,a,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(i&&(i+=" "),i+=a);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}function i(){for(var e,t,a=0,i="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(i&&(i+=" "),i+=t);return i}a.d(t,{Z:function(){return i}})}}]);